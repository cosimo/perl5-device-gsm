#!/usr/bin/perl
#
# Autoscan utility
# Creates a log file with all commands
#
# Please send the `profile.log' generated file to
# cosimo@cpan.org with subject "Device::Gsm profile"
#
# Usage: autoscan --port=/dev/ttyS0 --baud=19200 --file=profile.log
#
# $Id: autoscan,v 1.3 2003-12-15 23:39:04 cosimo Exp $

use Device::Gsm;
use Getopt::Long;

my $port = '/dev/ttyS1';
my $baud = 19200;
my $file = 'profile.log';

GetOptions( 'port:s'=>\$port, 'baud:i'=>\$baud, 'file:s'=>\$file );

my $gsm = new Device::Gsm( port => $port, log=>"file,$file", loglevel=>'info' );
$gsm->connect( baudrate => $baud ) or die "could not connect!\n";

print "Auto scan of device on $port (\@ $baud bps)\n\n";
$gsm->log->write('info', "# Autoscan of device on port $port (\@ $baud bps)");
$gsm->log->write('info', '# Device::Gsm v'.Device::Gsm->VERSION().', Device::Modem v'.Device::Modem->VERSION().', perl version '.$]);
$gsm->log->write('info', '# Started on '.localtime());


my @command = (
	'+CCLK', '+CGMI', '+CGMM', '+CGMR', '+CGSN',
	'+CSCA', '+CSQ',  '+CHUP', '+CPIN',
	'+CMGF', '+CMGL', '+CMGS',
	'^SBNR',
);

testcmd($gsm,$_) foreach @command;

$gsm->datetime();
$gsm->imei();
$gsm->manufacturer();
$gsm->model();
$gsm->software_version();
$gsm->service_center();
$gsm->signal_quality();
$gsm->messages();

sub testcmd {
	my $gsm = $_[0];
	my $cmd = $_[1];
	$gsm->log->write('info', 'testing command ['.$cmd.']');
	$gsm->test_command($cmd);
}

